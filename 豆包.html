<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¤ç‹¬ç—‡æƒ…ç»ªè¯†åˆ«è®­ç»ƒç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.19.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@1.0.5/dist/face-landmarks-detection.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4361EE',
                        secondary: '#FF6B6B',
                        success: '#2EC4B6',
                        warning: '#FFD166',
                        danger: '#EF4444',
                        light: '#F7F9FC',
                        dark: '#2B2D42'
                    },
                    fontFamily: {
                        nunito: ['Nunito', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .pulse-animation {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            .stage-lock {
                position: relative;
            }
            .stage-lock::after {
                content: 'ğŸ”’';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(255,255,255,0.7);
                border-radius: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 3rem;
                color: #ccc;
            }
        }
    </style>
</head>
<body class="font-nunito bg-gradient-to-br from-light to-blue-50 min-h-screen text-dark overflow-x-hidden">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-md fixed w-full z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-heart text-secondary text-2xl"></i>
                <span class="text-xl font-bold text-primary">æƒ…ç»ªå°è¾¾äºº</span>
            </div>
            
            <div class="hidden md:flex items-center space-x-6">
                <a href="#" class="font-medium hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-home mr-1"></i> é¦–é¡µ
                </a>
                <a href="#" class="font-medium hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-question-circle mr-1"></i> å¸®åŠ©
                </a>
                <a href="#" class="font-medium hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-user mr-1"></i> å…³äº
                </a>
            </div>
            
            <button id="sound-toggle" class="mr-2 text-gray-600 hover:text-primary transition-colors">
                <i class="fa fa-volume-up text-xl"></i>
            </button>
            
            <button id="mobile-menu-btn" class="md:hidden text-gray-600 hover:text-primary transition-colors">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- ç§»åŠ¨ç«¯èœå• -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#" class="py-2 font-medium hover:text-primary transition-colors">
                    <i class="fa fa-home mr-1"></i> é¦–é¡µ
                </a>
                <a href="#" class="py-2 font-medium hover:text-primary transition-colors">
                    <i class="fa fa-question-circle mr-1"></i> å¸®åŠ©
                </a>
                <a href="#" class="py-2 font-medium hover:text-primary transition-colors">
                    <i class="fa fa-user mr-1"></i> å…³äº
                </a>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 pt-24 pb-16">
        <!-- æ¬¢è¿ç•Œé¢ -->
        <section id="welcome-screen" class="py-8 text-center">
            <div class="max-w-3xl mx-auto">
                <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-extrabold text-primary mb-6 text-shadow">
                    æƒ…ç»ªå°è¾¾äººè®­ç»ƒç³»ç»Ÿ
                </h1>
                <p class="text-lg md:text-xl text-gray-600 mb-8">
                    è®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ è®¤è¯†å’Œè¡¨è¾¾ä¸åŒçš„æƒ…ç»ªï¼Œæˆä¸ºæƒ…ç»ªå°ä¸“å®¶ï¼
                </p>
                
                <div class="relative rounded-xl overflow-hidden shadow-xl mb-10 max-w-2xl mx-auto">
                    <img src="https://picsum.photos/seed/emotions/800/400" alt="å„ç§æƒ…ç»ªè¡¨æƒ…å±•ç¤º" class="w-full h-auto">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6">
                        <p class="text-white text-lg font-semibold">å››é˜¶æ®µè¿›é˜¶è®­ç»ƒï¼Œé€æ­¥æå‡æƒ…ç»ªè®¤çŸ¥èƒ½åŠ›</p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8">
                    <button id="start-training-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center">
                        <i class="fa fa-play-circle mr-2"></i> å¼€å§‹è®­ç»ƒ
                    </button>
                    <button id="view-guide-btn" class="bg-white hover:bg-gray-50 text-primary border-2 border-primary font-bold py-3 px-8 rounded-full text-lg shadow-md transition-all duration-300 flex items-center justify-center">
                        <i class="fa fa-book mr-2"></i> æŸ¥çœ‹æŒ‡å—
                    </button>
                </div>
                
                <div class="flex justify-center items-center text-gray-500">
                    <i class="fa fa-trophy text-warning mr-2"></i>
                    <span>å·²å¸®åŠ©1000+å°æœ‹å‹æŒæ¡æƒ…ç»ªè®¤çŸ¥æŠ€èƒ½</span>
                </div>
            </div>
        </section>

        <!-- é˜¶æ®µé€‰æ‹©ç•Œé¢ -->
        <section id="stage-selection" class="hidden">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-primary">é€‰æ‹©è®­ç»ƒé˜¶æ®µ</h2>
                <button id="back-to-welcome" class="text-gray-600 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-arrow-left mr-1"></i> è¿”å›
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- é˜¶æ®µ1 -->
                <div class="stage-card bg-white rounded-xl shadow-xl p-6 transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 cursor-pointer" data-stage="1">
                    <div class="bg-primary/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-primary text-2xl font-bold">1</span>
                    </div>
                    <h3 class="text-xl font-bold text-center mb-2">åŸºç¡€æ„ŸçŸ¥ä¸è¯†åˆ«</h3>
                    <p class="text-gray-600 text-center mb-4">å»ºç«‹åŸºæœ¬æƒ…ç»ªè¯†åˆ«èƒ½åŠ›</p>
                    <div class="flex justify-center">
                        <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                            å·²è§£é”
                        </span>
                    </div>
                </div>
                
                <!-- é˜¶æ®µ2 -->
                <div class="stage-card bg-white rounded-xl shadow-xl p-6 transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 cursor-pointer stage-lock" data-stage="2">
                    <div class="bg-info/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-info text-2xl font-bold">2</span>
                    </div>
                    <h3 class="text-xl font-bold text-center mb-2">æƒ…å¢ƒç†è§£ä¸åº”ç”¨</h3>
                    <p class="text-gray-600 text-center mb-4">ç†è§£æƒ…ç»ªä¸æƒ…å¢ƒçš„å…³è”</p>
                    <div class="flex justify-center">
                        <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                            å®Œæˆé˜¶æ®µ1è§£é”
                        </span>
                    </div>
                </div>
                
                <!-- é˜¶æ®µ3 -->
                <div class="stage-card bg-white rounded-xl shadow-xl p-6 transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 cursor-pointer stage-lock" data-stage="3">
                    <div class="bg-warning/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-warning text-2xl font-bold">3</span>
                    </div>
                    <h3 class="text-xl font-bold text-center mb-2">ç¤¾ä¼šè®¤çŸ¥ä¸è°ƒèŠ‚</h3>
                    <p class="text-gray-600 text-center mb-4">å­¦ä¹ ç¤¾ä¼šæƒ…å¢ƒä¸­çš„æƒ…ç»ªç®¡ç†</p>
                    <div class="flex justify-center">
                        <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                            å®Œæˆé˜¶æ®µ2è§£é”
                        </span>
                    </div>
                </div>
                
                <!-- é˜¶æ®µ4 -->
                <div class="stage-card bg-white rounded-xl shadow-xl p-6 transition-all duration-300 hover:shadow-2xl hover:-translate-y-1 cursor-pointer stage-lock" data-stage="4">
                    <div class="bg-secondary/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-secondary text-2xl font-bold">4</span>
                    </div>
                    <h3 class="text-xl font-bold text-center mb-2">ç»¼åˆåº”ç”¨ä¸æ³›åŒ–</h3>
                    <p class="text-gray-600 text-center mb-4">ç»¼åˆè¿ç”¨æƒ…ç»ªæŠ€èƒ½</p>
                    <div class="flex justify-center">
                        <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                            å®Œæˆé˜¶æ®µ3è§£é”
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¸¸æˆé€‰æ‹©ç•Œé¢ -->
        <section id="game-selection" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button id="back-to-stages" class="text-gray-600 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-arrow-left mr-1"></i> è¿”å›é˜¶æ®µé€‰æ‹©
                </button>
                <h2 id="stage-title" class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-primary">ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ„ŸçŸ¥ä¸è¯†åˆ«</h2>
                <div class="w-8"></div> <!-- å ä½å…ƒç´ ï¼Œä¿æŒæ ‡é¢˜å±…ä¸­ -->
            </div>
            
            <p id="stage-description" class="text-gray-600 mb-8 text-center max-w-2xl mx-auto">
                æœ¬é˜¶æ®µå°†å¸®åŠ©ä½ è®¤è¯†æœ€åŸºæœ¬çš„æƒ…ç»ªï¼Œå­¦ä¹ è¯†åˆ«ä¸åŒçš„é¢éƒ¨è¡¨æƒ…ã€‚
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- æ¸¸æˆ1ï¼šæƒ…ç»ªæ¨¡ä»¿æ¸¸æˆ -->
                <div class="game-card bg-white rounded-xl shadow-lg p-4 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 cursor-pointer border-2 border-transparent hover:border-primary" data-game="1">
                    <div class="h-40 overflow-hidden rounded-lg mb-4">
                        <img src="https://picsum.photos/seed/emotion1/400/300" alt="æƒ…ç»ªæ¨¡ä»¿æ¸¸æˆé¢„è§ˆ" class="w-full h-full object-cover">
                    </div>
                    <h3 class="text-lg font-bold mb-2">1. æƒ…ç»ªæ¨¡ä»¿æ¸¸æˆ</h3>
                    <p class="text-gray-600 text-sm mb-3">æ ¹æ®æç¤ºåšè¡¨æƒ…ï¼Œæ‘„åƒå¤´ä¼šè¯†åˆ«ä½ çš„è¡¨æƒ…æ˜¯å¦æ­£ç¡®</p>
                    <div class="flex items-center text-xs text-gray-500">
                        <i class="fa fa-star text-warning mr-1"></i>
                        <span>éš¾åº¦ï¼šç®€å•</span>
                    </div>
                </div>
                
                <!-- æ¸¸æˆ2ï¼šæƒ…ç»ªé€‰æ‹©æ¸¸æˆ -->
                <div class="game-card bg-white rounded-xl shadow-lg p-4 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 cursor-pointer border-2 border-transparent hover:border-primary" data-game="2">
                    <div class="h-40 overflow-hidden rounded-lg mb-4">
                        <img src="https://picsum.photos/seed/emotion2/400/300" alt="æƒ…ç»ªé€‰æ‹©æ¸¸æˆé¢„è§ˆ" class="w-full h-full object-cover">
                    </div>
                    <h3 class="text-lg font-bold mb-2">2. æƒ…ç»ªé€‰æ‹©æ¸¸æˆ</h3>
                    <p class="text-gray-600 text-sm mb-3">ä»å¤šä¸ªè¡¨æƒ…ä¸­é€‰æ‹©å‡ºæŒ‡å®šçš„æƒ…ç»ªè¡¨æƒ…</p>
                    <div class="flex items-center text-xs text-gray-500">
                        <i class="fa fa-star text-warning mr-1"></i>
                        <span>éš¾åº¦ï¼šç®€å•</span>
                    </div>
                </div>
                
                <!-- æ¸¸æˆ3ï¼šè¡¨æƒ…æ‹¼å›¾æ¸¸æˆ -->
                <div class="game-card bg-white rounded-xl shadow-lg p-4 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 cursor-pointer border-2 border-transparent hover:border-primary" data-game="3">
                    <div class="h-40 overflow-hidden rounded-lg mb-4">
                        <img src="https://picsum.photos/seed/emotion3/400/300" alt="è¡¨æƒ…æ‹¼å›¾æ¸¸æˆé¢„è§ˆ" class="w-full h-full object-cover">
                    </div>
                    <h3 class="text-lg font-bold mb-2">3. è¡¨æƒ…æ‹¼å›¾æ¸¸æˆ</h3>
                    <p class="text-gray-600 text-sm mb-3">é€šè¿‡æ‹–æ‹½ç¢ç‰‡å®Œæˆè¡¨æƒ…æ‹¼å›¾ï¼Œè®¤è¯†é¢éƒ¨ç‰¹å¾</p>
                    <div class="flex items-center text-xs text-gray-500">
                        <i class="fa fa-star text-warning mr-1"></i>
                        <span>éš¾åº¦ï¼šä¸­ç­‰</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¸¸æˆ1ï¼šæƒ…ç»ªæ¨¡ä»¿æ¸¸æˆ -->
        <section id="game-1" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button class="back-to-games text-gray-600 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-arrow-left mr-1"></i> è¿”å›æ¸¸æˆé€‰æ‹©
                </button>
                <h2 class="text-2xl font-bold text-primary">æƒ…ç»ªæ¨¡ä»¿æ¸¸æˆ</h2>
                <div class="flex items-center">
                    <span class="text-sm bg-primary/10 text-primary px-3 py-1 rounded-full mr-2">
                        ç¬¬ <span id="game1-current-round">1</span>/5 è½®
                    </span>
                    <div class="flex">
                        <i class="fa fa-star text-warning"></i>
                        <i class="fa fa-star-o text-gray-300"></i>
                        <i class="fa fa-star-o text-gray-300"></i>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">è¯·åšå‡ºä»¥ä¸‹è¡¨æƒ…</h3>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-6 text-center">
                        <div id="emotion-to-imitate" class="inline-block bg-primary/10 rounded-full p-4">
                            <i class="fa fa-angry text-5xl text-secondary"></i>
                            <p class="mt-2 text-xl font-bold text-primary">ç”Ÿæ°”</p>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="font-bold mb-2 text-center">è¡¨æƒ…æç¤º</h4>
                        <ul class="text-gray-600 space-y-2">
                            <li class="flex items-start">
                                <i class="fa fa-check-circle text-success mt-1 mr-2"></i>
                                <span>çœ‰æ¯›çš±èµ·æ¥</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fa fa-check-circle text-success mt-1 mr-2"></i>
                                <span>å˜´å·´ç´§é—­æˆ–å‘ä¸‹</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fa fa-check-circle text-success mt-1 mr-2"></i>
                                <span>å¯ä»¥æ¡ç´§æ‹³å¤´</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div id="game1-feedback" class="hidden p-4 rounded-lg text-center mb-6">
                        <!-- åé¦ˆå†…å®¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                    
                    <div class="flex justify-center">
                        <button id="game1-next-btn" class="hidden bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all">
                            ä¸‹ä¸€ä¸ª <i class="fa fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4 text-center">ä½ çš„è¡¨æƒ…</h3>
                    
                    <div class="relative rounded-lg overflow-hidden bg-gray-100 mb-4 aspect-video">
                        <video id="emotion-camera" autoplay playsinline class="w-full h-full object-cover"></video>
                        <canvas id="camera-canvas" class="absolute top-0 left-0 w-full h-full"></canvas>
                        
                        <!-- åŠ è½½çŠ¶æ€ -->
                        <div id="camera-loading" class="absolute inset-0 bg-white/80 flex flex-col items-center justify-center">
                            <div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mb-3"></div>
                            <p>æ­£åœ¨å‡†å¤‡æ‘„åƒå¤´...</p>
                        </div>
                        
                        <!-- æœªæ£€æµ‹åˆ°äººè„¸ -->
                        <div id="no-face-detected" class="absolute inset-0 bg-white/80 flex flex-col items-center justify-center hidden">
                            <i class="fa fa-meh-o text-5xl text-gray-400 mb-3"></i>
                            <p>è¯·å°†è„¸å¯¹å‡†æ‘„åƒå¤´</p>
                        </div>
                        
                        <!-- è¯†åˆ«ä¸­ -->
                        <div id="recognizing" class="absolute inset-0 bg-black/30 flex items-center justify-center hidden">
                            <div class="w-10 h-10 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button id="start-recognition" class="bg-secondary hover:bg-secondary/90 text-white font-bold py-2 px-6 rounded-full transition-all">
                            å¼€å§‹è¯†åˆ« <i class="fa fa-camera ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¸¸æˆ2ï¼šæƒ…ç»ªé€‰æ‹©æ¸¸æˆ -->
        <section id="game-2" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button class="back-to-games text-gray-600 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-arrow-left mr-1"></i> è¿”å›æ¸¸æˆé€‰æ‹©
                </button>
                <h2 class="text-2xl font-bold text-primary">æƒ…ç»ªé€‰æ‹©æ¸¸æˆ</h2>
                <div class="flex items-center">
                    <span class="text-sm bg-primary/10 text-primary px-3 py-1 rounded-full mr-2">
                        ç¬¬ <span id="game2-current-round">1</span>/5 è½®
                    </span>
                    <div class="flex">
                        <i class="fa fa-star text-warning"></i>
                        <i class="fa fa-star-o text-gray-300"></i>
                        <i class="fa fa-star-o text-gray-300"></i>
                    </div>
                </div>
            </div>
            
            <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
                <div class="text-center mb-8">
                    <h3 class="text-xl font-bold mb-2">è¯·æ‰¾å‡ºå“ªä¸€ä¸ªæ˜¯</h3>
                    <div class="inline-block bg-primary/10 rounded-full px-6 py-3">
                        <p class="text-2xl font-bold text-primary" id="target-emotion">å¼€å¿ƒ</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="emotion-option card-hover rounded-lg overflow-hidden cursor-pointer border-2 border-transparent hover:border-primary" data-emotion="happy">
                        <img src="https://picsum.photos/seed/happy/300/300" alt="å¼€å¿ƒçš„è¡¨æƒ…" class="w-full aspect-square object-cover">
                        <div class="p-2 text-center font-medium">å¼€å¿ƒ</div>
                    </div>
                    <div class="emotion-option card-hover rounded-lg overflow-hidden cursor-pointer border-2 border-transparent hover:border-primary" data-emotion="sad">
                        <img src="https://picsum.photos/seed/sad/300/300" alt="éš¾è¿‡çš„è¡¨æƒ…" class="w-full aspect-square object-cover">
                        <div class="p-2 text-center font-medium">éš¾è¿‡</div>
                    </div>
                    <div class="emotion-option card-hover rounded-lg overflow-hidden cursor-pointer border-2 border-transparent hover:border-primary" data-emotion="angry">
                        <img src="https://picsum.photos/seed/angry/300/300" alt="ç”Ÿæ°”çš„è¡¨æƒ…" class="w-full aspect-square object-cover">
                        <div class="p-2 text-center font-medium">ç”Ÿæ°”</div>
                    </div>
                    <div class="emotion-option card-hover rounded-lg overflow-hidden cursor-pointer border-2 border-transparent hover:border-primary" data-emotion="scared">
                        <img src="https://picsum.photos/seed/scared/300/300" alt="å®³æ€•çš„è¡¨æƒ…" class="w-full aspect-square object-cover">
                        <div class="p-2 text-center font-medium">å®³æ€•</div>
                    </div>
                </div>
                
                <div id="game2-feedback" class="hidden p-6 rounded-lg text-center mb-6">
                    <!-- åé¦ˆå†…å®¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
                
                <div class="flex justify-center">
                    <button id="game2-next-btn" class="hidden bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all">
                        ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- æ¸¸æˆ3ï¼šè¡¨æƒ…æ‹¼å›¾æ¸¸æˆ -->
        <section id="game-3" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button class="back-to-games text-gray-600 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-arrow-left mr-1"></i> è¿”å›æ¸¸æˆé€‰æ‹©
                </button>
                <h2 class="text-2xl font-bold text-primary">è¡¨æƒ…æ‹¼å›¾æ¸¸æˆ</h2>
                <div class="flex items-center">
                    <span class="text-sm bg-primary/10 text-primary px-3 py-1 rounded-full mr-2">
                        ç¬¬ <span id="game3-current-round">1</span>/3 è½®
                    </span>
                    <div class="flex">
                        <i class="fa fa-star text-warning"></i>
                        <i class="fa fa-star-o text-gray-300"></i>
                        <i class="fa fa-star-o text-gray-300"></i>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-6 h-full">
                        <h3 class="text-xl font-bold mb-4 text-center">å‚è€ƒå›¾ç‰‡</h3>
                        <div class="bg-gray-50 rounded-lg p-2 mb-6">
                            <img id="puzzle-reference" src="https://picsum.photos/seed/puzzle1/300/300" alt="æ‹¼å›¾å‚è€ƒè¡¨æƒ…" class="w-full rounded">
                        </div>
                        
                        <h4 class="font-bold mb-3">æ¸¸æˆæç¤º</h4>
                        <ul class="text-gray-600 space-y-2 mb-6">
                            <li class="flex items-start">
                                <i class="fa fa-lightbulb-o text-warning mt-1 mr-2"></i>
                                <span>è§‚å¯Ÿçœ¼ç›å’Œå˜´å·´çš„å½¢çŠ¶</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fa fa-lightbulb-o text-warning mt-1 mr-2"></i>
                                <span>æ‹–åŠ¨ç¢ç‰‡åˆ°æ­£ç¡®ä½ç½®</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fa fa-lightbulb-o text-warning mt-1 mr-2"></i>
                                <span>å®Œæˆåä¼šæœ‰æƒŠå–œå“¦</span>
                            </li>
                        </ul>
                        
                        <button id="show-hint" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 rounded-lg transition-all">
                            æç¤º <i class="fa fa-question-circle ml-1"></i>
                        </button>
                    </div>
                </div>
                
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-center">è¯·å®Œæˆæ‹¼å›¾</h3>
                        
                        <div id="puzzle-container" class="bg-gray-100 rounded-lg p-4 aspect-square max-w-md mx-auto relative">
                            <!-- æ‹¼å›¾ç¢ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            <div class="absolute inset-0 flex items-center justify-center" id="puzzle-complete-message" style="display: none;">
                                <div class="text-center bg-white p-6 rounded-xl shadow-lg">
                                    <i class="fa fa-check-circle text-5xl text-success mb-3"></i>
                                    <h4 class="text-xl font-bold mb-2">å¤ªæ£’äº†ï¼</h4>
                                    <p class="mb-4">ä½ å®Œæˆäº†è¿™ä¸ªè¡¨æƒ…æ‹¼å›¾</p>
                                    <button id="game3-next-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full transition-all">
                                        ä¸‹ä¸€ä¸ªæ‹¼å›¾ <i class="fa fa-arrow-right ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¸¸æˆå®Œæˆç•Œé¢ -->
        <section id="game-complete" class="hidden text-center py-8">
            <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-xl p-8">
                <div class="inline-block bg-success/10 rounded-full p-4 mb-6">
                    <i class="fa fa-trophy text-5xl text-warning"></i>
                </div>
                
                <h2 class="text-2xl md:text-3xl font-bold text-primary mb-4">æ­å–œä½ å®Œæˆè®­ç»ƒï¼</h2>
                <p class="text-gray-600 mb-6">ä½ åœ¨æœ¬æ¬¡è®­ç»ƒä¸­è¡¨ç°éå¸¸å‡ºè‰²ï¼Œç»§ç»­åŠ æ²¹å“¦ï¼</p>
                
                <div class="mb-8">
                    <div class="flex justify-center mb-2">
                        <i class="fa fa-star text-warning text-2xl"></i>
                        <i class="fa fa-star text-warning text-2xl"></i>
                        <i class="fa fa-star text-warning text-2xl"></i>
                    </div>
                    <p class="text-gray-500">è·å¾—äº†3é¢—æ˜Ÿæ˜Ÿï¼</p>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="play-again-btn" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-full transition-all">
                        å†ç©ä¸€æ¬¡ <i class="fa fa-refresh ml-1"></i>
                    </button>
                    <button id="return-to-stages-btn" class="bg-white hover:bg-gray-50 text-primary border-2 border-primary font-bold py-3 px-8 rounded-full transition-all">
                        è¿”å›é˜¶æ®µé€‰æ‹© <i class="fa fa-th-large ml-1"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- å¸®åŠ©æŒ‡å—ç•Œé¢ -->
        <section id="guide-screen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <button id="back-from-guide" class="text-gray-600 hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-arrow-left mr-1"></i> è¿”å›
                </button>
                <h2 class="text-2xl font-bold text-primary">ä½¿ç”¨æŒ‡å—</h2>
                <div class="w-8"></div> <!-- å ä½å…ƒç´  -->
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-info-circle text-primary mr-2"></i>
                        å…³äºæœ¬ç³»ç»Ÿ
                    </h3>
                    <p class="text-gray-600 mb-4">
                        æƒ…ç»ªå°è¾¾äººè®­ç»ƒç³»ç»Ÿæ˜¯ä¸“ä¸ºå­¤ç‹¬ç—‡å„¿ç«¥è®¾è®¡çš„æƒ…ç»ªè®¤çŸ¥è®­ç»ƒå·¥å…·ï¼Œé€šè¿‡å››ä¸ªè¿›é˜¶é˜¶æ®µçš„12ç§å°æ¸¸æˆï¼Œå¸®åŠ©å­©å­é€æ­¥æŒæ¡æƒ…ç»ªè¯†åˆ«å’Œè¡¨è¾¾èƒ½åŠ›ã€‚
                    </p>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-graduation-cap text-primary mr-2"></i>
                        é˜¶æ®µä»‹ç»
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-bold text-primary">ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ„ŸçŸ¥ä¸è¯†åˆ«</h4>
                            <p class="text-gray-600 text-sm">å­¦ä¹ è¯†åˆ«åŸºæœ¬æƒ…ç»ªï¼ˆå¼€å¿ƒã€éš¾è¿‡ã€ç”Ÿæ°”ã€å®³æ€•ï¼‰çš„é¢éƒ¨è¡¨æƒ…ç‰¹å¾ã€‚</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-bold text-primary">ç¬¬äºŒé˜¶æ®µï¼šæƒ…å¢ƒç†è§£ä¸åº”ç”¨</h4>
                            <p class="text-gray-600 text-sm">ç†è§£æƒ…ç»ªä¸å…·ä½“æƒ…å¢ƒçš„å…³è”ï¼Œå­¦ä¹ åŒºåˆ†æƒ…ç»ªçš„å¼ºåº¦ã€‚</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-bold text-primary">ç¬¬ä¸‰é˜¶æ®µï¼šç¤¾ä¼šè®¤çŸ¥ä¸è°ƒèŠ‚</h4>
                            <p class="text-gray-600 text-sm">å­¦ä¹ åœ¨ç¤¾äº¤åœºåˆä¸­è¯†åˆ«å’Œç®¡ç†æƒ…ç»ªï¼Œç†è§£ä»–äººçš„æƒ…ç»ªçŠ¶æ€ã€‚</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-bold text-primary">ç¬¬å››é˜¶æ®µï¼šç»¼åˆåº”ç”¨ä¸æ³›åŒ–</h4>
                            <p class="text-gray-600 text-sm">ç»¼åˆè¿ç”¨æ‰€å­¦æŠ€èƒ½ï¼Œå­¦ä¼šè¡¨è¾¾å’Œè½¬åŒ–å„ç§æƒ…ç»ªã€‚</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-gamepad text-primary mr-2"></i>
                        æ¸¸æˆæ“ä½œè¯´æ˜
                    </h3>
                    <p class="text-gray-600 mb-4">
                        æ¯ä¸ªæ¸¸æˆéƒ½æœ‰ç®€å•æ˜ç¡®çš„æ“ä½œæŒ‡å¼•ï¼Œè¯·æ ¹æ®å±å¹•ä¸Šçš„æç¤ºè¿›è¡Œæ“ä½œã€‚å®Œæˆæ¸¸æˆåä¼šè·å¾—æ˜Ÿæ˜Ÿå¥–åŠ±ï¼Œç§¯ç´¯è¶³å¤Ÿçš„æ˜Ÿæ˜Ÿå¯ä»¥è§£é”æ–°çš„é˜¶æ®µã€‚
                    </p>
                    <p class="text-gray-600">
                        å¯¹äºéœ€è¦ä½¿ç”¨æ‘„åƒå¤´çš„æ¸¸æˆï¼Œè¯·ç¡®ä¿å·²æˆäºˆæ‘„åƒå¤´æƒé™ï¼Œè¿™å°†å¸®åŠ©ç³»ç»Ÿè¯†åˆ«è¡¨æƒ…å¹¶ç»™äºˆåé¦ˆã€‚
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-dark text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fa fa-heart text-secondary"></i>
                        <span class="font-bold">æƒ…ç»ªå°è¾¾äººè®­ç»ƒç³»ç»Ÿ</span>
                    </div>
                    <p class="text-gray-400 text-sm">ä¸“ä¸ºå­¤ç‹¬ç—‡å„¿ç«¥è®¾è®¡çš„æƒ…ç»ªè®¤çŸ¥å·¥å…·</p>
                </div>
                
                <div class="flex flex-col items-center md:items-end">
                    <div class="flex space-x-4 mb-2">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-facebook"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-instagram"></i>
                        </a>
                    </div>
                    <p class="text-gray-400 text-sm">&copy; 2023 æƒ…ç»ªå°è¾¾äºº ç‰ˆæƒæ‰€æœ‰</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // DOMå…ƒç´ 
        const welcomeScreen = document.getElementById('welcome-screen');
        const stageSelection = document.getElementById('stage-selection');
        const gameSelection = document.getElementById('game-selection');
        const guideScreen = document.getElementById('guide-screen');
        const gameCompleteScreen = document.getElementById('game-complete');
        
        // æ¸¸æˆç•Œé¢
        const game1 = document.getElementById('game-1');
        const game2 = document.getElementById('game-2');
        const game3 = document.getElementById('game-3');
        
        // å¯¼èˆªæŒ‰é’®
        const startTrainingBtn = document.getElementById('start-training-btn');
        const viewGuideBtn = document.getElementById('view-guide-btn');
        const backToWelcome = document.getElementById('back-to-welcome');
        const backToStages = document.getElementById('back-to-stages');
        const backFromGuide = document.getElementById('back-from-guide');
        const returnToStagesBtn = document.getElementById('return-to-stages-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const soundToggle = document.getElementById('sound-toggle');
        
        // å£°éŸ³çŠ¶æ€
        let soundEnabled = true;
        
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // å£°éŸ³åˆ‡æ¢
        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            if (soundEnabled) {
                soundToggle.innerHTML = '<i class="fa fa-volume-up text-xl"></i>';
            } else {
                soundToggle.innerHTML = '<i class="fa fa-volume-off text-xl"></i>';
            }
        });
        
        // é¡µé¢å¯¼èˆª
        startTrainingBtn.addEventListener('click', () => {
            welcomeScreen.classList.add('hidden');
            stageSelection.classList.remove('hidden');
            playSound('click');
        });
        
        viewGuideBtn.addEventListener('click', () => {
            welcomeScreen.classList.add('hidden');
            guideScreen.classList.remove('hidden');
            playSound('click');
        });
        
        backFromGuide.addEventListener('click', () => {
            guideScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            playSound('click');
        });
        
        backToWelcome.addEventListener('click', () => {
            stageSelection.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            playSound('click');
        });
        
        backToStages.addEventListener('click', () => {
            gameSelection.classList.add('hidden');
            stageSelection.classList.remove('hidden');
            playSound('click');
        });
        
        returnToStagesBtn.addEventListener('click', () => {
            gameCompleteScreen.classList.add('hidden');
            stageSelection.classList.remove('hidden');
            playSound('click');
        });
        
        playAgainBtn.addEventListener('click', () => {
            gameCompleteScreen.classList.add('hidden');
            game1.classList.remove('hidden');
            resetGame1();
            playSound('click');
        });
        
        // é˜¶æ®µé€‰æ‹©
        document.querySelectorAll('.stage-card').forEach(card => {
            if (!card.classList.contains('stage-lock')) {
                card.addEventListener('click', () => {
                    const stage = card.getAttribute('data-stage');
                    loadStageGames(stage);
                    stageSelection.classList.add('hidden');
                    gameSelection.classList.remove('hidden');
                    playSound('click');
                });
            }
        });
        
        // åŠ è½½é˜¶æ®µæ¸¸æˆ
        function loadStageGames(stage) {
            const stageTitle = document.getElementById('stage-title');
            const stageDescription = document.getElementById('stage-description');
            
            // æ ¹æ®é˜¶æ®µè®¾ç½®æ ‡é¢˜å’Œæè¿°
            switch(stage) {
                case '1':
                    stageTitle.textContent = 'ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ„ŸçŸ¥ä¸è¯†åˆ«';
                    stageDescription.textContent = 'æœ¬é˜¶æ®µå°†å¸®åŠ©ä½ è®¤è¯†æœ€åŸºæœ¬çš„æƒ…ç»ªï¼Œå­¦ä¹ è¯†åˆ«ä¸åŒçš„é¢éƒ¨è¡¨æƒ…ã€‚';
                    break;
                case '2':
                    stageTitle.textContent = 'ç¬¬äºŒé˜¶æ®µï¼šæƒ…å¢ƒç†è§£ä¸åº”ç”¨';
                    stageDescription.textContent = 'æœ¬é˜¶æ®µå°†å¸®åŠ©ä½ ç†è§£æƒ…ç»ªä¸æƒ…å¢ƒçš„å…³ç³»ï¼Œå­¦ä¹ åŒºåˆ†æƒ…ç»ªçš„å¼ºåº¦ã€‚';
                    break;
                case '3':
                    stageTitle.textContent = 'ç¬¬ä¸‰é˜¶æ®µï¼šç¤¾ä¼šè®¤çŸ¥ä¸è°ƒèŠ‚';
                    stageDescription.textContent = 'æœ¬é˜¶æ®µå°†å¸®åŠ©ä½ å­¦ä¹ åœ¨ç¤¾äº¤åœºåˆä¸­è¯†åˆ«å’Œç®¡ç†æƒ…ç»ªï¼Œç†è§£ä»–äººæ„Ÿå—ã€‚';
                    break;
                case '4':
                    stageTitle.textContent = 'ç¬¬å››é˜¶æ®µï¼šç»¼åˆåº”ç”¨ä¸æ³›åŒ–';
                    stageDescription.textContent = 'æœ¬é˜¶æ®µå°†å¸®åŠ©ä½ ç»¼åˆè¿ç”¨æƒ…ç»ªæŠ€èƒ½ï¼Œå­¦ä¼šè¡¨è¾¾å’Œè½¬åŒ–å„ç§æƒ…ç»ªã€‚';
                    break;
            }
        }
        
        // æ¸¸æˆé€‰æ‹©
        document.querySelectorAll('.game-card').forEach(card => {
            card.addEventListener('click', () => {
                const game = card.getAttribute('data-game');
                gameSelection.classList.add('hidden');
                
                // éšè—æ‰€æœ‰æ¸¸æˆï¼Œæ˜¾ç¤ºé€‰ä¸­çš„æ¸¸æˆ
                document.querySelectorAll('[id^="game-"]').forEach(g => {
                    g.classList.add('hidden');
                });
                
                document.getElementById(`game-${game}`).classList.remove('hidden');
                
                // å¦‚æœæ˜¯æ¸¸æˆ1ï¼Œåˆå§‹åŒ–æ‘„åƒå¤´
                if (game === '1') {
                    initCamera();
                } 
                // å¦‚æœæ˜¯æ¸¸æˆ3ï¼Œåˆå§‹åŒ–æ‹¼å›¾
                else if (game === '3') {
                    initPuzzle();
                }
                
                playSound('click');
            });
        });
        
        // è¿”å›æ¸¸æˆé€‰æ‹©
        document.querySelectorAll('.back-to-games').forEach(btn => {
            btn.addEventListener('click', () => {
                // éšè—æ‰€æœ‰æ¸¸æˆ
                document.querySelectorAll('[id^="game-"]').forEach(g => {
                    g.classList.add('hidden');
                });
                
                gameSelection.classList.remove('hidden');
                playSound('click');
            });
        });
        
        // æ¸¸æˆ1ï¼šæƒ…ç»ªæ¨¡ä»¿æ¸¸æˆ
        let currentEmotionIndex = 0;
        const emotions = [
            { name: 'å¼€å¿ƒ', icon: 'fa-smile-o', color: 'text-yellow-500', hints: ['å˜´è§’ä¸Šæ‰¬', 'çœ¼ç›å¯èƒ½çœ¯èµ·æ¥', 'è¡¨æƒ…æ”¾æ¾'] },
            { name: 'éš¾è¿‡', icon: 'fa-frown-o', color: 'text-blue-500', hints: ['å˜´è§’å‘ä¸‹', 'å¯èƒ½ä¼šæµæ³ª', 'è¡¨æƒ…æ²‰é‡'] },
            { name: 'ç”Ÿæ°”', icon: 'fa-angry', color: 'text-red-500', hints: ['çœ‰æ¯›çš±èµ·æ¥', 'å˜´å·´ç´§é—­æˆ–å‘ä¸‹', 'å¯ä»¥æ¡ç´§æ‹³å¤´'] },
            { name: 'å®³æ€•', icon: 'fa-fear', color: 'text-purple-500', hints: ['çœ¼ç›çå¤§', 'å˜´å·´å¼ å¼€', 'å¯èƒ½ä¼šåé€€'] },
            { name: 'æƒŠè®¶', icon: 'fa-surprise', color: 'text-green-500', hints: ['çœ¼ç›çå¤§', 'å˜´å·´å¼ å¼€æˆOå½¢', 'çœ‰æ¯›ä¸Šæ‰¬'] }
        ];
        
        const emotionToImitate = document.getElementById('emotion-to-imitate');
        const startRecognitionBtn = document.getElementById('start-recognition');
        const game1Feedback = document.getElementById('game1-feedback');
        const game1NextBtn = document.getElementById('game1-next-btn');
        const game1CurrentRound = document.getElementById('game1-current-round');
        
        // åˆå§‹åŒ–æ¸¸æˆ1
        function initGame1() {
            currentEmotionIndex = 0;
            updateGame1Emotion();
            game1CurrentRound.textContent = currentEmotionIndex + 1;
            game1Feedback.classList.add('hidden');
            game1NextBtn.classList.add('hidden');
        }
        
        // é‡ç½®æ¸¸æˆ1
        function resetGame1() {
            initGame1();
            document.getElementById('camera-loading').classList.remove('hidden');
            document.getElementById('no-face-detected').classList.add('hidden');
            initCamera();
        }
        
        // æ›´æ–°æ¸¸æˆ1çš„æƒ…ç»ª
        function updateGame1Emotion() {
            const emotion = emotions[currentEmotionIndex];
            emotionToImitate.innerHTML = `
                <i class="fa ${emotion.icon} text-5xl ${emotion.color}"></i>
                <p class="mt-2 text-xl font-bold text-primary">${emotion.name}</p>
            `;
            
            // æ›´æ–°æç¤º
            const hintList = document.querySelector('#game-1 .text-gray-600.space-y-2');
            hintList.innerHTML = '';
            emotion.hints.forEach(hint => {
                const li = document.createElement('li');
                li.className = 'flex items-start';
                li.innerHTML = `<i class="fa fa-check-circle text-success mt-1 mr-2"></i><span>${hint}</span>`;
                hintList.appendChild(li);
            });
        }
        
        // åˆå§‹åŒ–æ‘„åƒå¤´
        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.getElementById('emotion-camera');
                video.srcObject = stream;
                
                video.onloadedmetadata = () => {
                    document.getElementById('camera-loading').classList.add('hidden');
                };
                
                // åŠ è½½é¢éƒ¨è¯†åˆ«æ¨¡å‹
                await loadFaceDetectionModel();
            } catch (err) {
                console.error('æ— æ³•è®¿é—®æ‘„åƒå¤´:', err);
                document.getElementById('camera-loading').innerHTML = `
                    <i class="fa fa-exclamation-triangle text-5xl text-warning mb-3"></i>
                    <p>æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®</p>
                `;
            }
        }
        
        // é¢éƒ¨æ£€æµ‹æ¨¡å‹
        let model;
        async function loadFaceDetectionModel() {
            model = await faceLandmarksDetection.load(
                faceLandmarksDetection.SupportedPackages.mediapipeFacemesh
            );
        }
        
        // å¼€å§‹è¯†åˆ«è¡¨æƒ…
        startRecognitionBtn.addEventListener('click', async () => {
            startRecognitionBtn.disabled = true;
            startRecognitionBtn.innerHTML = 'è¯†åˆ«ä¸­... <i class="fa fa-spinner fa-spin ml-1"></i>';
            document.getElementById('recognizing').classList.remove('hidden');
            
            // æ¨¡æ‹Ÿè¯†åˆ«è¿‡ç¨‹ï¼ˆå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨çœŸå®çš„è¡¨æƒ…è¯†åˆ«ç®—æ³•ï¼‰
            setTimeout(async () => {
                const video = document.getElementById('emotion-camera');
                const canvas = document.getElementById('camera-canvas');
                const ctx = canvas.getContext('2d');
                
                // è®¾ç½®canvaså°ºå¯¸ä¸è§†é¢‘ä¸€è‡´
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // ç»˜åˆ¶å½“å‰è§†é¢‘å¸§åˆ°canvas
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // æ£€æµ‹é¢éƒ¨
                const predictions = await model.estimateFaces({ input: video });
                
                document.getElementById('recognizing').classList.add('hidden');
                
                if (predictions.length > 0) {
                    // æ£€æµ‹åˆ°äººè„¸ï¼Œæ¨¡æ‹Ÿè¯†åˆ«ç»“æœï¼ˆ70%æ¦‚ç‡æˆåŠŸï¼‰
                    const success = Math.random() > 0.3;
                    
                    if (success) {
                        // è¯†åˆ«æˆåŠŸ
                        game1Feedback.className = 'p-4 rounded-lg text-center mb-6 bg-success/20 text-success';
                        game1Feedback.innerHTML = `
                            <i class="fa fa-check-circle text-2xl mb-2"></i>
                            <p class="font-bold">å¤ªæ£’äº†ï¼ä½ åšå¯¹äº†${emotions[currentEmotionIndex].name}çš„è¡¨æƒ…ï¼</p>
                        `;
                        game1Feedback.classList.remove('hidden');
                        game1NextBtn.classList.remove('hidden');
                        playSound('success');
                    } else {
                        // è¯†åˆ«å¤±è´¥
                        game1Feedback.className = 'p-4 rounded-lg text-center mb-6 bg-warning/20 text-warning';
                        game1Feedback.innerHTML = `
                            <i class="fa fa-exclamation-circle text-2xl mb-2"></i>
                            <p>å†è¯•ä¸€æ¬¡å§ï¼Œè¯•ç€${emotions[currentEmotionIndex].hints[0]}</p>
                        `;
                        game1Feedback.classList.remove('hidden');
                        startRecognitionBtn.disabled = false;
                        startRecognitionBtn.innerHTML = 'é‡æ–°è¯†åˆ« <i class="fa fa-camera ml-1"></i>';
                        playSound('tryagain');
                    }
                } else {
                    // æœªæ£€æµ‹åˆ°äººè„¸
                    document.getElementById('no-face-detected').classList.remove('hidden');
                    startRecognitionBtn.disabled = false;
                    startRecognitionBtn.innerHTML = 'é‡æ–°è¯†åˆ« <i class="fa fa-camera ml-1"></i>';
                    playSound('error');
                }
            }, 2000);
        });
        
        // ä¸‹ä¸€ä¸ªæƒ…ç»ª
        game1NextBtn.addEventListener('click', () => {
            currentEmotionIndex++;
            game1Feedback.classList.add('hidden');
            game1NextBtn.classList.add('hidden');
            startRecognitionBtn.disabled = false;
            startRecognitionBtn.innerHTML = 'å¼€å§‹è¯†åˆ« <i class="fa fa-camera ml-1"></i>';
            
            if (currentEmotionIndex < emotions.length) {
                // è¿˜æœ‰ä¸‹ä¸€ä¸ªæƒ…ç»ª
                updateGame1Emotion();
                game1CurrentRound.textContent = currentEmotionIndex + 1;
                document.getElementById('no-face-detected').classList.add('hidden');
                playSound('click');
            } else {
                // å®Œæˆæ‰€æœ‰æƒ…ç»ª
                game1.classList.add('hidden');
                gameCompleteScreen.classList.remove('hidden');
                playSound('complete');
            }
        });
        
        // æ¸¸æˆ2ï¼šæƒ…ç»ªé€‰æ‹©æ¸¸æˆ
        let currentTargetEmotionIndex = 0;
        const targetEmotions = ['å¼€å¿ƒ', 'éš¾è¿‡', 'ç”Ÿæ°”', 'å®³æ€•', 'æƒŠè®¶'];
        const targetEmotionElement = document.getElementById('target-emotion');
        const game2Feedback = document.getElementById('game2-feedback');
        const game2NextBtn = document.getElementById('game2-next-btn');
        const game2CurrentRound = document.getElementById('game2-current-round');
        const emotionOptions = document.querySelectorAll('.emotion-option');
        
        // åˆå§‹åŒ–æ¸¸æˆ2
        function initGame2() {
            currentTargetEmotionIndex = 0;
            targetEmotionElement.textContent = targetEmotions[currentTargetEmotionIndex];
            game2CurrentRound.textContent = currentTargetEmotionIndex + 1;
            game2Feedback.classList.add('hidden');
            game2NextBtn.classList.add('hidden');
            
            // é‡ç½®é€‰é¡¹æ ·å¼
            emotionOptions.forEach(option => {
                option.classList.remove('border-success', 'border-danger', 'opacity-50');
                option.classList.add('border-transparent');
                option.style.pointerEvents = 'auto';
            });
        }
        
        // ä¸ºæ¸¸æˆ2é€‰é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
        emotionOptions.forEach(option => {
            option.addEventListener('click', () => {
                const selectedEmotion = option.getAttribute('data-emotion');
                const targetEmotion = targetEmotions[currentTargetEmotionIndex];
                
                // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
                emotionOptions.forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
                
                // æ£€æŸ¥ç­”æ¡ˆ
                if (selectedEmotion === targetEmotion.toLowerCase()) {
                    // æ­£ç¡®
                    option.classList.remove('border-transparent', 'border-primary');
                    option.classList.add('border-success');
                    
                    game2Feedback.className = 'p-4 rounded-lg text-center mb-6 bg-success/20 text-success';
                    game2Feedback.innerHTML = `
                        <i class="fa fa-check-circle text-2xl mb-2"></i>
                        <p class="font-bold">æ­£ç¡®ï¼è¿™æ˜¯${targetEmotion}çš„è¡¨æƒ…</p>
                    `;
                    playSound('success');
                } else {
                    // é”™è¯¯
                    option.classList.remove('border-transparent', 'border-primary');
                    option.classList.add('border-danger');
                    
                    // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                    emotionOptions.forEach(opt => {
                        if (opt.getAttribute('data-emotion') === targetEmotion.toLowerCase()) {
                            opt.classList.remove('border-transparent', 'border-primary');
                            opt.classList.add('border-success');
                        } else if (opt !== option) {
                            opt.classList.add('opacity-50');
                        }
                    });
                    
                    game2Feedback.className = 'p-4 rounded-lg text-center mb-6 bg-danger/20 text-danger';
                    game2Feedback.innerHTML = `
                        <i class="fa fa-times-circle text-2xl mb-2"></i>
                        <p>è¿™ä¸æ˜¯${targetEmotion}çš„è¡¨æƒ…ï¼Œæ­£ç¡®ç­”æ¡ˆåœ¨è¿™é‡Œ</p>
                    `;
                    playSound('error');
                }
                
                game2Feedback.classList.remove('hidden');
                game2NextBtn.classList.remove('hidden');
            });
        });
        
        // æ¸¸æˆ2ä¸‹ä¸€é¢˜
        game2NextBtn.addEventListener('click', () => {
            currentTargetEmotionIndex++;
            
            if (currentTargetEmotionIndex < targetEmotions.length) {
                // è¿˜æœ‰ä¸‹ä¸€é¢˜
                initGame2();
                playSound('click');
            } else {
                // å®Œæˆæ‰€æœ‰é¢˜ç›®
                game2.classList.add('hidden');
                gameCompleteScreen.classList.remove('hidden');
                playSound('complete');
            }
        });
        
        // æ¸¸æˆ3ï¼šè¡¨æƒ…æ‹¼å›¾æ¸¸æˆ
        let currentPuzzleIndex = 0;
        const puzzleImages = [
            'https://picsum.photos/seed/puzzle1/300/300',
            'https://picsum.photos/seed/puzzle2/300/300',
            'https://picsum.photos/seed/puzzle3/300/300'
        ];
        const puzzleReference = document.getElementById('puzzle-reference');
        const puzzleContainer = document.getElementById('puzzle-container');
        const showHintBtn = document.getElementById('show-hint');
        const game3CurrentRound = document.getElementById('game3-current-round');
        const game3NextBtn = document.getElementById('game3-next-btn');
        const puzzleCompleteMessage = document.getElementById('puzzle-complete-message');
        
        // åˆå§‹åŒ–æ‹¼å›¾
        function initPuzzle() {
            currentPuzzleIndex = 0;
            updatePuzzle();
            game3CurrentRound.textContent = currentPuzzleIndex + 1;
            puzzleCompleteMessage.style.display = 'none';
        }
        
        // æ›´æ–°æ‹¼å›¾
        function updatePuzzle() {
            puzzleReference.src = puzzleImages[currentPuzzleIndex];
            createPuzzlePieces(puzzleImages[currentPuzzleIndex]);
        }
        
        // åˆ›å»ºæ‹¼å›¾ç¢ç‰‡
        function createPuzzlePieces(imageUrl) {
            // æ¸…ç©ºå®¹å™¨
            puzzleContainer.innerHTML = '';
            
            // åˆ›å»º4x4çš„æ‹¼å›¾ç¢ç‰‡
            const rows = 4;
            const cols = 4;
            const pieceCount = rows * cols;
            
            // è®¡ç®—æ¯ä¸ªç¢ç‰‡çš„å°ºå¯¸
            const pieceWidth = puzzleContainer.clientWidth / cols;
            const pieceHeight = puzzleContainer.clientHeight / rows;
            
            // åˆ›å»ºç¢ç‰‡æ•°ç»„
            const pieces = [];
            for (let i = 0; i < pieceCount; i++) {
                const row = Math.floor(i / cols);
                const col = i % cols;
                
                const piece = document.createElement('div');
                piece.className = 'absolute cursor-move transition-all shadow-md';
                piece.style.width = `${pieceWidth}px`;
                piece.style.height = `${pieceHeight}px`;
                piece.style.backgroundImage = `url(${imageUrl})`;
                piece.style.backgroundSize = `${puzzleContainer.clientWidth}px ${puzzleContainer.clientHeight}px`;
                piece.style.backgroundPosition = `-${col * pieceWidth}px -${row * pieceHeight}px`;
                piece.dataset.index = i;
                piece.dataset.row = row;
                piece.dataset.col = col;
                
                // è®°å½•æ­£ç¡®ä½ç½®
                piece.dataset.correctX = col * pieceWidth;
                piece.dataset.correctY = row * pieceHeight;
                
                pieces.push(piece);
            }
            
            // æ‰“ä¹±ç¢ç‰‡ä½ç½®
            const shuffledPieces = shuffleArray(pieces);
            
            // éšæœºæ”¾ç½®ç¢ç‰‡
            shuffledPieces.forEach((piece, index) => {
                // éšæœºä½ç½®
                const randomX = Math.floor(Math.random() * (puzzleContainer.clientWidth - pieceWidth));
                const randomY = Math.floor(Math.random() * (puzzleContainer.clientHeight - pieceHeight));
                
                piece.style.left = `${randomX}px`;
                piece.style.top = `${randomY}px`;
                
                // æ·»åŠ æ‹–æ‹½åŠŸèƒ½
                makeDraggable(piece, pieceWidth, pieceHeight);
                
                puzzleContainer.appendChild(piece);
            });
            
            // æ·»åŠ å®Œæˆæ¶ˆæ¯å®¹å™¨
            puzzleContainer.appendChild(puzzleCompleteMessage);
        }
        
        // æ‰“ä¹±æ•°ç»„é¡ºåº
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // ä½¿å…ƒç´ å¯æ‹–æ‹½
        function makeDraggable(element, pieceWidth, pieceHeight) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            element.onmousedown = dragMouseDown;
            element.ontouchstart = dragTouchStart;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // è·å–é¼ æ ‡åˆå§‹ä½ç½®
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // å½“é¼ æ ‡ç§»åŠ¨æ—¶è°ƒç”¨elementDragå‡½æ•°
                document.onmousemove = elementDrag;
                // æå‡å½“å‰å…ƒç´ å±‚çº§
                element.style.zIndex = 100;
            }
            
            function dragTouchStart(e) {
                e = e || window.event;
                e.preventDefault();
                // è·å–è§¦æ‘¸åˆå§‹ä½ç½®
                pos3 = e.touches[0].clientX;
                pos4 = e.touches[0].clientY;
                document.ontouchend = closeDragElement;
                // å½“è§¦æ‘¸ç§»åŠ¨æ—¶è°ƒç”¨elementDragå‡½æ•°
                document.ontouchmove = elementTouchDrag;
                // æå‡å½“å‰å…ƒç´ å±‚çº§
                element.style.zIndex = 100;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // è®¡ç®—æ–°çš„ä½ç½®
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // è®¾ç½®å…ƒç´ æ–°çš„ä½ç½®
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
                // æ£€æŸ¥æ˜¯å¦æ”¾ç½®åœ¨æ­£ç¡®ä½ç½®
                checkPosition(element);
            }
            
            function elementTouchDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // è®¡ç®—æ–°çš„ä½ç½®
                pos1 = pos3 - e.touches[0].clientX;
                pos2 = pos4 - e.touches[0].clientY;
                pos3 = e.touches[0].clientX;
                pos4 = e.touches[0].clientY;
                // è®¾ç½®å…ƒç´ æ–°çš„ä½ç½®
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
                // æ£€æŸ¥æ˜¯å¦æ”¾ç½®åœ¨æ­£ç¡®ä½ç½®
                checkPosition(element);
            }
            
            function closeDragElement() {
                // åœæ­¢ç§»åŠ¨
                document.onmouseup = null;
                document.onmousemove = null;
                document.ontouchend = null;
                document.ontouchmove = null;
                // æ¢å¤å±‚çº§
                element.style.zIndex = 10;
                // æœ€ç»ˆæ£€æŸ¥ä½ç½®
                checkPosition(element);
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç¢ç‰‡éƒ½å·²æ­£ç¡®æ”¾ç½®
                checkAllPieces();
            }
        }
        
        // æ£€æŸ¥ç¢ç‰‡æ˜¯å¦æ”¾ç½®åœ¨æ­£ç¡®ä½ç½®
        function checkPosition(element) {
            const correctX = parseInt(element.dataset.correctX);
            const correctY = parseInt(element.dataset.correctY);
            const tolerance = 20; // å®¹é”™èŒƒå›´
            
            const currentX = parseInt(element.style.left);
            const currentY = parseInt(element.style.top);
            
            // æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®ä½ç½®é™„è¿‘
            if (
                Math.abs(currentX - correctX) < tolerance &&
                Math.abs(currentY - correctY) < tolerance
            ) {
                // å›ºå®šåœ¨æ­£ç¡®ä½ç½®
                element.style.left = `${correctX}px`;
                element.style.top = `${correctY}px`;
                element.style.cursor = 'default';
                element.onmousedown = null;
                element.ontouchstart = null;
                element.classList.add('opacity-100');
                element.classList.remove('opacity-70');
                return true;
            }
            
            element.classList.add('opacity-70');
            return false;
        }
        
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç¢ç‰‡éƒ½å·²æ­£ç¡®æ”¾ç½®
        function checkAllPieces() {
            const pieces = puzzleContainer.querySelectorAll('[data-index]');
            let allCorrect = true;
            
            pieces.forEach(piece => {
                const correctX = parseInt(piece.dataset.correctX);
                const correctY = parseInt(piece.dataset.correctY);
                const currentX = parseInt(piece.style.left);
                const currentY = parseInt(piece.style.top);
                
                if (currentX !== correctX || currentY !== correctY) {
                    allCorrect = false;
                }
            });
            
            if (allCorrect) {
                // æ‰€æœ‰ç¢ç‰‡éƒ½å·²æ­£ç¡®æ”¾ç½®
                setTimeout(() => {
                    puzzleCompleteMessage.style.display = 'flex';
                    playSound('complete');
                }, 500);
            }
        }
        
        // æç¤ºæŒ‰é’®
        showHintBtn.addEventListener('click', () => {
            const pieces = puzzleContainer.querySelectorAll('[data-index]');
            // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœªæ­£ç¡®æ”¾ç½®çš„ç¢ç‰‡
            for (let i = 0; i < pieces.length; i++) {
                const piece = pieces[i];
                const correctX = parseInt(piece.dataset.correctX);
                const correctY = parseInt(piece.dataset.correctY);
                const currentX = parseInt(piece.style.left);
                const currentY = parseInt(piece.style.top);
                
                if (currentX !== correctX || currentY !== correctY) {
                    // é—ªçƒæç¤ºè¯¥ç¢ç‰‡çš„æ­£ç¡®ä½ç½®
                    const hintMarker = document.createElement('div');
                    hintMarker.className = 'absolute border-2 border-primary rounded animate-pulse';
                    hintMarker.style.width = piece.style.width;
                    hintMarker.style.height = piece.style.height;
                    hintMarker.style.left = `${correctX}px`;
                    hintMarker.style.top = `${correctY}px`;
                    hintMarker.style.zIndex = 50;
                    
                    puzzleContainer.appendChild(hintMarker);
                    
                    // 3ç§’åç§»é™¤æç¤º
                    setTimeout(() => {
                        hintMarker.remove();
                    }, 3000);
                    
                    playSound('hint');
                    break;
                }
            }
        });
        
        // æ¸¸æˆ3ä¸‹ä¸€ä¸ªæ‹¼å›¾
        game3NextBtn.addEventListener('click', () => {
            currentPuzzleIndex++;
            
            if (currentPuzzleIndex < puzzleImages.length) {
                // è¿˜æœ‰ä¸‹ä¸€ä¸ªæ‹¼å›¾
                updatePuzzle();
                game3CurrentRound.textContent = currentPuzzleIndex + 1;
                playSound('click');
            } else {
                // å®Œæˆæ‰€æœ‰æ‹¼å›¾
                game3.classList.add('hidden');
                gameCompleteScreen.classList.remove('hidden');
                playSound('complete');
            }
        });
        
        // å£°éŸ³æ’­æ”¾å‡½æ•°
        function playSound(type) {
            if (!soundEnabled) return;
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„éŸ³æ•ˆæ–‡ä»¶
            console.log(`æ’­æ”¾${type}éŸ³æ•ˆ`);
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        window.addEventListener('DOMContentLoaded', () => {
            // ä¸ºæ‰€æœ‰æ¸¸æˆæ·»åŠ è¿”å›æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.back-to-games').forEach(btn => {
                btn.addEventListener('click', () => {
                    // åœæ­¢æ‘„åƒå¤´
                    const video = document.getElementById('emotion-camera');
                    if (video && video.srcObject) {
                        video.srcObject.getTracks().forEach(track => track.stop());
                    }
                });
            });
        });
    </script>
</body>
</html>