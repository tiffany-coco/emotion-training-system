<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>æƒ…ç»ªç†è§£è®­ç»ƒ Â· ç«–å±ç®€æ´ç‰ˆ</title>
<style>
  :root{--bg:#0b1020;--panel:#0f1530;--card:#121a3a;--text:#e9edff;--muted:#aab4ff;--line:#2a3561;--brand:#5b8cff;--ok:#27c17d;--bad:#ff5d6a;--warn:#f7b955;--r:18px}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b1020,#0b1126);color:var(--text);font-family:-apple-system,system-ui,"PingFang SC","Noto Sans SC",Arial}
  .app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;max-width:520px;margin:0 auto}
  header{position:sticky;top:0;background:rgba(15,21,48,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:20}
  .bar{display:flex;align-items:center;gap:10px;padding:10px 14px}
  .bar h1{font-size:18px;margin:0;font-weight:800;letter-spacing:.2px}
  .bar .act{margin-left:auto;display:flex;gap:8px}
  .btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--line);background:#151d42;color:var(--text);border-radius:14px;padding:10px 14px;font-weight:700;min-height:44px;min-width:44px;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
  .btn.primary{background:linear-gradient(90deg,var(--brand),#73a4ff);border-color:transparent;color:#fff}
  .btn.ghost{background:transparent}
  .btn:active{transform:scale(.98)}
  main{padding:12px}
  .sec{background:linear-gradient(160deg,var(--panel),#0d1330);border:1px solid var(--line);border-radius:var(--r);padding:12px;margin-bottom:12px}
  .sec h2{font-size:16px;margin:0 0 8px 0}
  .grid{display:grid;grid-template-columns:1fr;gap:8px}
  .tile{display:flex;align-items:center;gap:10px;background:linear-gradient(160deg,#121a3a,#0e1533);border:1px solid var(--line);border-radius:14px;padding:12px}
  .tile .ico{font-size:24px}
  .tile .meta{margin-left:auto;color:var(--muted);font-size:12px}
  .hero{display:flex;align-items:center;gap:10px;margin-bottom:8px}
  .hero .ico{font-size:22px}
  .card{background:linear-gradient(160deg,#11183a,#0d1330);border:1px solid var(--line);border-radius:16px;padding:12px}
  .face{font-size:84px;line-height:1;text-align:center}
  .choices{display:grid;grid-template-columns:1fr;gap:10px}
  .choice{border:2px solid var(--line);border-radius:14px;background:#151d42;color:var(--text);min-height:64px;font-size:18px;font-weight:700}
  .choice.good{border-color:var(--ok);background:linear-gradient(180deg,#10271f,#0e1f19)}
  .choice.bad{border-color:var(--bad);background:linear-gradient(180deg,#2a1620,#1c0f14)}
  .row{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#1b234a;color:var(--muted);font-size:12px}
  .drag-wrap{display:grid;gap:10px}
  .dropzone{min-height:120px;border:2px dashed var(--line);border-radius:14px;padding:10px;display:flex;gap:8px;flex-wrap:wrap}
  .draggable{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#1a2147;font-size:18px}
  .dropzone.over{background:rgba(91,140,255,.08)}
  .canvas{width:100%;height:280px;border-radius:12px;background:#0a0f24;border:1px solid var(--line);display:grid;place-items:center;position:relative}
  .face-base{font-size:96px}
  .sticker-bar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
  footer{padding:8px 14px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="bar">
      <h1>ğŸ¯ æƒ…ç»ªç†è§£è®­ç»ƒ Â· ç«–å±</h1>
      <div class="act">
        <button class="btn" id="btnHome">ğŸ </button>
        <button class="btn" id="btnReport">ğŸ“ˆ</button>
        <button class="btn" id="btnExport">ğŸ§¾</button>
      </div>
    </div>
  </header>
  <main id="main" tabindex="-1" aria-live="polite"></main>
  <footer>Â© <span id="y"></span> æƒ…ç»ªç†è§£è®­ç»ƒ Â· ç«–å±ç®€æ´ç‰ˆ Â· æœ¬åœ°è¿è¡Œ / iPad è§¦æ§ä¼˜åŒ–</footer>
</div>
<script>
(function(){
  const $=(s,el=document)=>el.querySelector(s);
  const $$=(s,el=document)=>Array.from(el.querySelectorAll(s));
  const DB_KEY='emo.train.v2';
  const state={score:{}, profile:{name:'å­¦ç”ŸA'}, prefs:{speech:true}};
  const speak=(t)=>{ if(!state.prefs.speech) return; try{const u=new SpeechSynthesisUtterance(t);u.lang='zh-CN';speechSynthesis.cancel();speechSynthesis.speak(u);}catch(e){} };
  const save=()=>localStorage.setItem(DB_KEY,JSON.stringify(state));
  const load=()=>{try{const raw=localStorage.getItem(DB_KEY); if(raw) Object.assign(state, JSON.parse(raw));}catch(e){} };
  const bump=(gid,ok)=>{ const s=state.score[gid]||(state.score[gid]={ok:0,ng:0,best:0,last:''}); if(ok) s.ok++; else s.ng++; s.best=Math.max(s.best,s.ok); s.last=new Date().toLocaleString(); save(); };
  const csv=()=>{ const rows=[["game","ok","ng","best","last"]]; Object.entries(state.score).forEach(([g,s])=>rows.push([g,s.ok||0,s.ng||0,s.best||0,s.last||''])); return rows.map(r=>r.join(',')).join('\n'); };
  const download=(name,content)=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([content],{type:'text/plain;charset=utf-8;'})); a.download=name; a.click(); URL.revokeObjectURL(a.href); };

  function home(){
    const s=(id,title,icon,items)=>`<section class="sec"><div class="hero"><div class="ico">${icon}</div><h2>${title}</h2></div><div class="grid">${items.map(x=>`<button class="tile" onclick="location.hash='${x.hash}'"><div class='ico'>${x.emo}</div><div>${x.name}</div><div class='meta'>æœ€ä½³ ${ (state.score[x.id]?.best)||0 }</div></button>`).join('')}</div></section>`;
    $('#main').innerHTML=
      s('s1','ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ„ŸçŸ¥ä¸è¯†åˆ«','ğŸµ',[
        {id:'g1',hash:'#g1',emo:'ğŸ˜Š',name:'(1) æƒ…ç»ªæŒ‡è®¤'},
        {id:'g2',hash:'#g2',emo:'ğŸ§©',name:'(2) æƒ…ç»ªé…å¯¹'},
        {id:'g3',hash:'#g3',emo:'ğŸ­',name:'(3) æƒ…ç»ªæ¨¡ä»¿(ç›¸æœº)'},
      ])+
      s('s2','ç¬¬äºŒé˜¶æ®µï¼šæƒ…å¢ƒç†è§£ä¸åº”ç”¨','ğŸ“š',[
        {id:'g4',hash:'#g4',emo:'ğŸ–¼ï¸',name:'(4) æƒ…å¢ƒé…å¯¹'},
        {id:'g5',hash:'#g5',emo:'ğŸ§ ',name:'(5) æƒ…ç»ªåŸå› æ¨æµ‹'},
        {id:'g6',hash:'#g6',emo:'ğŸ“¶',name:'(6) æƒ…ç»ªå¼ºåº¦æ’åº'},
      ])+
      s('s3','ç¬¬ä¸‰é˜¶æ®µï¼šç¤¾ä¼šè®¤çŸ¥ä¸è°ƒèŠ‚','ğŸ‘¥',[
        {id:'g7',hash:'#g7',emo:'ğŸ§­',name:'(7) ç¤¾ä¼šæƒ…å¢ƒå†³ç­–'},
        {id:'g8',hash:'#g8',emo:'ğŸ’¨',name:'(8) æƒ…ç»ªè°ƒèŠ‚ç­–ç•¥'},
        {id:'g9',hash:'#g9',emo:'ğŸ¤',name:'(9) å…±æƒ…ç†è§£'},
      ])+
      s('s4','ç¬¬å››é˜¶æ®µï¼šç»¼åˆåº”ç”¨ä¸æ³›åŒ–','ğŸŒŸ',[
        {id:'g10',hash:'#g10',emo:'ğŸ‘§',name:'(10) æ¢è„¸å°å¥³å­©'},
        {id:'g11',hash:'#g11',emo:'ğŸ«§',name:'(11) æ¶ˆé™¤åæƒ…ç»ª'},
        {id:'g12',hash:'#g12',emo:'ğŸ¨',name:'(12) æƒ…ç»ªç»˜ç”»è¡¨è¾¾'},
      ]);
    speak('è¯·é€‰æ‹©ä¸€ä¸ªè®­ç»ƒå¼€å§‹ã€‚');
  }

  function report(){
    const list=Object.entries(state.score);
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸ“ˆ</div><h2>å­¦ä¹ æŠ¥å‘Š</h2></div><div class='card'><table style='width:100%;border-collapse:collapse;font-size:14px'><thead><tr><th style='text-align:left;padding:6px;border-bottom:1px solid var(--line)'>æ¸¸æˆ</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>âœ…</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>âŒ</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>ğŸ†</th><th style='text-align:right;padding:6px;border-bottom:1px solid var(--line)'>æœ€è¿‘</th></tr></thead><tbody>${list.map(([g,s])=>`<tr><td style='padding:6px;border-bottom:1px dashed var(--line)'>${g}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.ok||0}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.ng||0}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.best||0}</td><td style='padding:6px;text-align:right;border-bottom:1px dashed var(--line)'>${s.last||'â€”'}</td></tr>`).join('')}</tbody></table></div><div class='row' style='margin-top:8px'><span class='chip'>æœ¬åœ°ä¿å­˜ Â· å¯å¯¼å‡º CSV</span><button class='btn primary' id='back'>è¿”å›ä¸»é¡µ</button></div></section>`;
    $('#back').onclick=()=>{location.hash='#home'}
  }

  // ====== å·²å®ç°å°æ¸¸æˆï¼šg1 æŒ‡è®¤ã€g10 æ¢è„¸ã€g11 æ¶ˆæ¶ˆä¹ ======
  function g1(){
    const all=[{emo:'é«˜å…´',icon:'ğŸ˜Š'},{emo:'ä¼¤å¿ƒ',icon:'ğŸ˜¢'},{emo:'ç”Ÿæ°”',icon:'ğŸ˜ '},{emo:'å®³æ€•',icon:'ğŸ˜¨'}];
    const s=state.score.g1||{}; const level=Math.min(4,2+Math.floor((s.best||0)/5));
    const pool=all.slice(0,level); const ans=pool[Math.floor(Math.random()*pool.length)];
    const opts=[...pool].sort(()=>Math.random()-.5);
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸµ</div><h2>(1) æƒ…ç»ªæŒ‡è®¤</h2></div><div class='card'><div class='face'>${ans.icon}</div><p style='text-align:center;color:var(--muted)'>è¯·ç‚¹å‡»ï¼šè¿™æ˜¯ä»€ä¹ˆæƒ…ç»ªï¼Ÿ</p><div class='choices'>${opts.map(o=>`<button class='choice' data-v='${o.emo}'>${o.emo}</button>`).join('')}</div><div class='row' style='margin-top:8px'><span class='chip'>âœ… ${(s.ok||0)}ã€€âŒ ${(s.ng||0)}ã€€ğŸ† ${(s.best||0)}</span><div class='row' style='gap:6px'><button class='btn' id='speak'>ğŸ”Š</button><button class='btn primary' id='next'>ä¸‹ä¸€é¢˜</button></div></div></div></section>`;
    speak('è¿™æ˜¯ä»€ä¹ˆæƒ…ç»ªï¼Ÿ');
    $('#speak').onclick=()=>speak('è¿™æ˜¯ä»€ä¹ˆæƒ…ç»ªï¼Ÿ');
    $$('.choice').forEach(b=> b.onclick=()=>{ const ok=b.dataset.v===ans.emo; b.classList.add(ok?'good':'bad'); bump('g1',ok); speak(ok?`ä½ çœŸæ£’ï¼è¿™æ˜¯${ans.emo}`:`å†æƒ³æƒ³ï¼Œè¿™æ˜¯${ans.emo}å“¦`); setTimeout(()=>g1(),600); });
    $('#next').onclick=()=>g1();
  }

  function g10(){
    // æ¢è„¸å°å¥³å­©ï¼šæŠŠæ­£ç¡®æƒ…ç»ªè´´çº¸æ‹–åˆ°å°å¥³å­©è„¸ä¸Š
    const target='ç”Ÿæ°”';
    const stickers=[
      {emo:'é«˜å…´',icon:'ğŸ˜Š'},{emo:'ä¼¤å¿ƒ',icon:'ğŸ˜¢'},{emo:'ç”Ÿæ°”',icon:'ğŸ˜ '},{emo:'å®³æ€•',icon:'ğŸ˜¨'}
    ].sort(()=>Math.random()-.5);
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸŒŸ</div><h2>(10) æ¢è„¸å°å¥³å­©</h2></div><div class='card'><div class='canvas' id='canvas'><div style='text-align:center'><div style='font-size:42px'>ğŸ‘§</div><div class='chip'>é¢˜ç›®ï¼šé€‰æ‹© <b>${target}</b> çš„è¡¨æƒ…å¹¶æ”¾åˆ°å°å¥³å­©è„¸ä¸Š</div></div></div><div class='sticker-bar' id='bar'>${stickers.map(s=>`<div class='draggable' draggable='true' data-emo='${s.emo}' style='font-size:28px'>${s.icon}</div>`).join('')}</div><div class='row' style='margin-top:8px'><span class='chip'>æ‹–æ‹½è¡¨æƒ…åˆ°å°å¥³å­©è„¸ä¸Š</span><button class='btn primary' id='again'>å†æ¥ä¸€é¢˜</button></div></div></section>`;
    const canvas=$('#canvas');
    canvas.addEventListener('dragover',e=>{e.preventDefault(); canvas.classList.add('over')});
    canvas.addEventListener('dragleave',()=>canvas.classList.remove('over'));
    canvas.addEventListener('drop',e=>{e.preventDefault(); canvas.classList.remove('over'); const emo=e.dataTransfer.getData('text/plain'); const ok=emo===target; if(ok){ canvas.innerHTML=`<div style='text-align:center'><div style='font-size:42px'>ğŸ‘§</div><div style='font-size:72px;line-height:1'>ğŸ˜ </div><div class='chip'>ä½ çœŸæ£’ï¼</div></div>`; bump('g10',true); speak('ä½ çœŸæ£’ï¼'); }else{ bump('g10',false); speak('å†æƒ³æƒ³'); } });
    $$('.draggable').forEach(d=>{ d.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', d.dataset.emo) }); });
    $('#again').onclick=()=>g10();
  }

  function g11(){
    // æ¶ˆé™¤åæƒ…ç»ªï¼šç‚¹æ‰è´Ÿé¢è¡¨æƒ…
    const pos=['ğŸ˜Š','ğŸ¥°','ğŸ˜','ğŸ˜„']; const neg=['ğŸ˜ ','ğŸ˜¢','ğŸ˜¨','ğŸ˜'];
    const pool=[...pos,...neg].sort(()=>Math.random()-.5).slice(0,8);
    const need=pool.filter(x=>neg.includes(x)).length; let killed=0;
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>ğŸŒŸ</div><h2>(11) æ¶ˆé™¤åæƒ…ç»ª</h2></div><div class='card'><p class='chip'>å·²æ¶ˆé™¤ï¼š<b id='k'>0</b> / ${need} ä¸ªåæƒ…ç»ª</p><div class='choices' id='list'>${pool.map(e=>`<button class='choice' data-emo='${e}' style='font-size:28px;min-height:60px'>${e}</button>`).join('')}</div><div class='row' style='margin-top:8px'><button class='btn primary' id='again'>å†æ¥ä¸€è½®</button></div></div></section>`;
    $('#list').onclick=(ev)=>{ const b=ev.target.closest('.choice'); if(!b) return; const emo=b.dataset.emo; const isNeg=neg.includes(emo); if(isNeg){ b.classList.add('good'); b.disabled=true; killed++; $('#k').textContent=killed; bump('g11',true); if(killed===need) speak('å¤ªæ£’äº†ï¼Œå…¨éƒ¨æ¸…é™¤ï¼'); }else{ b.classList.add('bad'); bump('g11',false); speak('è¿™æ˜¯å¥½æƒ…ç»ªï¼Œç•™ä¸‹å®ƒ'); setTimeout(()=>b.classList.remove('bad'),400); } };
    $('#again').onclick=()=>g11();
  }

  // ====== å ä½é¡µé¢ï¼ˆå…¶ä½™9ä¸ªæ¸¸æˆç¨åè¡¥é½äº¤äº’ï¼‰ ======
  function coming(id,title,tip){
    $('#main').innerHTML=`<section class='sec'><div class='hero'><div class='ico'>â³</div><h2>${title}</h2></div><div class='card'><p style='color:var(--muted)'>${tip||'å¼€å‘ä¸­ï¼šå°†åŠ å…¥å›¾ç‰‡/è¯­éŸ³/æ‹–æ‹½/æ‘„åƒå¤´ç­‰äº¤äº’ã€‚'}</p><div class='row'><button class='btn primary' id='back'>è¿”å›ä¸»é¡µ</button></div></div></section>`;
    $('#back').onclick=()=>{location.hash='#home'};
  }

  // è·¯ç”±
  const routes={
    '#home':home,'':home,
    '#report':report,
    '#g1':g1,'#g2':()=>coming('g2','(2) æƒ…ç»ªé…å¯¹','æŠŠç›¸åŒæƒ…ç»ªæ‹–è¿›ç›®æ ‡æ¡†ï¼Œè®­ç»ƒâ€œæ³›åŒ–â€'),
    '#g3':()=>coming('g3','(3) æƒ…ç»ªæ¨¡ä»¿(ç›¸æœº)','å¼€å¯æ‘„åƒå¤´ï¼Œè·Ÿéšè¯­éŸ³åšè¡¨æƒ…ï¼Œæ•™å¸ˆç¡®è®¤è¯„åˆ†'),
    '#g4':()=>coming('g4','(4) æƒ…å¢ƒé…å¯¹','æƒ…å¢ƒå›¾ç‰‡â†’é€‰æ‹©æƒ…ç»ªï¼Œå¹¶ç»™å‡ºå› æœè§£é‡Š'),
    '#g5':()=>coming('g5','(5) æƒ…ç»ªåŸå› æ¨æµ‹','ä»è¡¨æƒ…åæ¨å¯èƒ½çš„åŸå› '),
    '#g6':()=>coming('g6','(6) æƒ…ç»ªå¼ºåº¦æ’åº','æ‹–åŠ¨å¡ç‰‡ä»è½»å¾®â†’ä¸­ç­‰â†’å¼ºçƒˆ'),
    '#g7':()=>coming('g7','(7) ç¤¾ä¼šæƒ…å¢ƒå†³ç­–','é‡åˆ°æ’é˜Ÿ/æ‰“æ‰°ç­‰ï¼Œé€‰æ‹©åˆé€‚ååº”'),
    '#g8':()=>coming('g8','(8) æƒ…ç»ªè°ƒèŠ‚ç­–ç•¥','æ·±å‘¼å¸/æ•°æ•°/æ‰¾å¤§äºº/ç”»ç”»ï¼Œæä¾›åˆ†æ­¥æŒ‡å¯¼'),
    '#g9':()=>coming('g9','(9) å…±æƒ…ç†è§£','è¯»çŸ­æ•…äº‹ï¼Œåˆ¤æ–­è§’è‰²æ„Ÿå—'),
    '#g10':g10,'#g11':g11,'#g12':()=>coming('g12','(12) æƒ…ç»ªç»˜ç”»è¡¨è¾¾','åœ¨äººè„¸æ¨¡æ¿ä¸Šç»˜åˆ¶â€œä»Šå¤©çš„è¡¨æƒ…â€å¹¶ä¿å­˜'),
  };
  function router(){ (routes[location.hash]||home)(); window.scrollTo({top:0,behavior:'instant'}); }

  // å…¨å±€æŒ‰é’®
  function bind(){
    $('#btnHome').onclick=()=>location.hash='#home';
    $('#btnReport').onclick=()=>location.hash='#report';
    $('#btnExport').onclick=()=>download('report.csv', csv());
  }

  // å¯åŠ¨
  load(); bind(); router(); window.addEventListener('hashchange',router); $('#y').textContent=new Date().getFullYear();
})();
</script>
</body>
</html>
